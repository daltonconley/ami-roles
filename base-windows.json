{
  "variables":{
    "build":"",
    "ami_profile":"",
    "job_tag":"",
    "software_version":"",
    "hvm_amiid":"",
    "date":"",
    "security_group_id":"",
    "subnet_id":"",
    "region":"",
    "vpc_id":"",
    "instance_type":""
  },
  "builders":[
    {
      "name":"hvm_builder",
      "user_data_file": "ec2-user-data.ps1",
      "type": "amazon-ebs",
      "source_ami": "{{user `hvm_amiid`}}",
      "communicator": "winrm",
      "ssh_port": "5985",
      "winrm_port": "5985",
      "winrm_username": "Administrator",
      "associate_public_ip_address": "true",
      "subnet_id":"{{user `subnet_id`}}",
      "instance_type": "{{user `instance_type`}}",
      "security_group_id":"{{user `security_group_id`}}",
      "vpc_id":"{{user `vpc_id`}}",
      "ami_name": "{{user `ami_profile`}}_build-{{user `build`}}_Source-{{user `hvm_amiid`}}_Built-{{user `date`}}",
      "region":"{{user `region`}}",
      "tags": {
        "Name":"{{user `ami_profile`}}-{{user `build`}}",
        "source":"{{user `hvm_amiid`}}",
        "virtualization_type":"hvm",
        "build":"{{user `build`}}",
        "profile":"{{user `ami_profile`}}",
        "creator":"packer",
        "creation_time":"{{user `date`}}"
      }
    }
  ],
  "provisioners":[
    {
      "type":"powershell",
      "inline":[
        "Invoke-WebRequest http://download.microsoft.com/download/7/9/6/796EF2E4-801B-4FC4-AB28-B59FBF6D907B/VCForPython27.msi -OutFile C:/Users/Administrator/vcpy27.msi",
        "Start-Process C:\\Users\\Administrator\\vcpy27.msi /passive -Wait",
        "Invoke-WebRequest https://www.python.org/ftp/python/2.7.10/python-2.7.10.msi -OutFile C:/Users/Administrator/python.msi",
        "Start-Process C:\\Users\\Administrator\\python.msi /passive -Wait",
        "C:\\Python27\\Scripts\\pip.exe install ansible",
        "mkdir C:\\Users\\Administrator\\ansible-packer",
        "mkdir C:\\Users\\Administrator\\ansible-packer\\roles"
      ]
    },
    {
      "type": "file",
      "source":"roles/",
      "destination": "C:/Users/Administrator/ansible-packer/roles"
    },
    {
      "type": "ansible-local",
      "playbook_file": "{{user `ami_profile`}}.yml",
      "group_vars": "group_vars",
      "staging_directory":"C:/Users/Administrator/ansible-packer"
    }
  ]
}
